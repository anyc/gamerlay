# HG changeset patch
# User David Gow <david@ingeniumdigital.com>
# Date 1362822158 -28800
# Node ID e4ce88b90d6079ed1ef0c4bd40abd652e475a8fc
# Parent  792af948ee02e474d9077389cde5396d8101b448
Emulate libtool's release option in CMake

diff -r 792af948ee02 -r e4ce88b90d60 CMakeLists.txt
--- a/CMakeLists.txt	Sat Mar 09 16:55:02 2013 +0800
+++ b/CMakeLists.txt	Sat Mar 09 17:42:38 2013 +0800
@@ -38,6 +38,8 @@
 math(EXPR LT_CURRENT "${SDL_MICRO_VERSION} - ${SDL_INTERFACE_AGE}")
 math(EXPR LT_AGE "${SDL_BINARY_AGE} - ${SDL_INTERFACE_AGE}")
 set(LT_REVISION "${SDL_INTERFACE_AGE}")
+set(LT_RELEASE "${SDL_MAJOR_VERSION}.${SDL_MINOR_VERSION}")
+set(LT_VERSION "${LT_CURRENT}.${LT_REVISION}.${LT_AGE}")
 
 # General settings & flags
 set(LIBRARY_OUTPUT_DIRECTORY "build")
@@ -1135,9 +1137,17 @@
 
 if(SDL_SHARED)
   add_library(SDL2 SHARED ${SOURCE_FILES})
-  set_target_properties(SDL2 PROPERTIES
-    VERSION ${SDL_VERSION}
-    SOVERSION ${LT_CURRENT})
+  if(UNIX)
+    set_target_properties(SDL2 PROPERTIES
+      VERSION ${LT_VERSION}
+      SOVERSION ${LT_CURRENT}
+      OUTPUT_NAME "SDL2-${LT_RELEASE}")
+  else(UNIX)
+    set_target_properties(SDL2 PROPERTIES
+      VERSION ${SDL_VERSION}
+      SOVERSION ${LT_CURRENT}
+      OUTPUT_NAME "SDL2")
+  endif(UNIX)
  set(_INSTALL_LIBS "SDL2" ${_INSTALL_LIBS})
  target_link_libraries(SDL2 ${EXTRA_LIBS} ${EXTRA_LDFLAGS})
 endif(SDL_SHARED)
@@ -1165,6 +1175,13 @@
 list(APPEND INCLUDE_FILES ${BIN_INCLUDE_FILES})
 install(FILES ${INCLUDE_FILES} DESTINATION include/SDL2)
 
+if(SDL_SHARED)
+  install(CODE "
+    execute_process(COMMAND ${CMAKE_COMMAND} -E create_symlink
+    \"libSDL2-2.0.so\" \"libSDL2.so\")")
+  install(FILES ${SDL2_BINARY_DIR}/libSDL2.so DESTINATION "lib${LIB_SUFFIX}")
+endif(SDL_SHARED)
+
 if(NOT WINDOWS OR CYGWIN)
   if(FREEBSD)
     # FreeBSD uses ${PREFIX}/libdata/pkgconfig
